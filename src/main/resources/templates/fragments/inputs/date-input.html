<!DOCTYPE html>
<html th:lang="${#locale.language}" xmlns:th="http://www.thymeleaf.org">
<div th:fragment="date-input (input, data)"
     class="form-group"
     th:classappend="${!inputData.valid(data)} ? 'form-group--error' : ''"
     th:with="inputData=${data.get(input.name)},
              formInputName=${T(org.codeforamerica.shiba.pages.PageUtils).getFormInputName(input.name)},
              hasError=${!data.isValid() && !inputData.valid(data)},
              hasHelpMessage=${input.helpMessageKey != null},
              needsAriaLabel=${input.needsAriaLabel()},
              isEndDateField=${#strings.endsWith(input.name, 'EndDate')},//insuranceNoEndDate
			  noEndDateInputName=${#strings.substring(input.name, 0, #strings.length(input.name) - 7) + 'NoEndDate'},
			  noEndDateInpuData=${data.get(noEndDateInputName)},
			  noEndDateChecked=${isEndDateField and noEndDateInpuData !=null and noEndDateInpuData.value.contains('true')}">
	 <fieldset class="date-input">
        <div th:replace="~{fragments/form-question-prompt :: formQuestionPrompt(${input})}"></div>
        <p class="text--help">
            <label th:for="${input.name}+'-month'"
                   th:id="${input.name}+'-month-label'"
                   th:text="#{general.month}"></label>
            &nbsp;/&nbsp;
            <label th:for="${input.name}+'-day'"
                   th:id="${input.name}+'-day-label'"
                   th:text="#{general.day}"></label>
            &nbsp;/&nbsp;
            <label th:for="${input.name}+'-year'"
                   th:id="${input.name}+'-year-label'"
                   th:text="#{general.year}"></label>
        </p>
        <input type="text" inputmode="numeric" maxlength="2" class="text-input form-width--2-character dob-input"
               th:id="${input.name}+'-month'" th:name="${formInputName}"
               th:value="${(!inputData.value.isEmpty() and #lists.size(inputData.value) > 0) ? inputData.value[0]: ''}"
               th:placeholder="mm"
               th:disabled="${noEndDateChecked}"
               th:attr="aria-describedby=${hasHelpMessage ? input.name + '-help-message' : ''},
                        aria-labelledby=${needsAriaLabel ? '' : input.name + '-label'},
                        aria-invalid=${hasError}"/>
        &nbsp;/&nbsp;
        <input type="text" inputmode="numeric" maxlength="2" class="text-input form-width--2-character dob-input"
               th:id="${input.name}+'-day'"
               th:name="${formInputName}" th:value="${(!inputData.value.isEmpty() and #lists.size(inputData.value) > 1) ? inputData.value[1]: ''}"
               th:placeholder="dd"
               th:disabled="${noEndDateChecked}"
               th:attr="aria-describedby=${hasHelpMessage ? input.name + '-help-message' : ''},
                        aria-labelledby=${needsAriaLabel ? '' : input.name + '-label'},
                        aria-invalid=${hasError}"/>
        &nbsp;/&nbsp;
        <input type="text" inputmode="numeric" maxlength="4" class="text-input form-width--4-character dob-input"
               th:id="${input.name}+'-year'"
               th:name="${formInputName}" th:value="${(!inputData.value.isEmpty() and #lists.size(inputData.value) > 2) ? inputData.value[2]: ''}"
               th:placeholder="yyyy"
               th:disabled="${noEndDateChecked}"
               th:attr="aria-describedby=${hasHelpMessage ? input.name + '-help-message' : ''},
                        aria-labelledby=${needsAriaLabel ? '' : input.name + '-label'},
                        aria-invalid=${hasError}"/>
    </fieldset>
    <div th:replace="~{fragments/inputErrorFragment :: validationError(${data}, ${input})}"></div>
    <th:block th:if="${#strings.endsWith(input.name, 'EndDate')}">
	     
		 <span style="display:none"
            th:attr="data-no-end-date-checkbox-name=${#strings.contains(formInputName, 'EndDate[]') ? #strings.replace(formInputName, 'EndDate[]', 'NoEndDate[]') : #strings.replace(formInputName, 'EndDate', 'NoEndDate')}"></span>
      
<script>
	(function () {
		var scriptEl = document.currentScript;
		var formGroup = scriptEl && scriptEl.closest && scriptEl.closest('.form-group');
		if (!formGroup) return;

		var spanEl = formGroup.querySelector('span[data-no-end-date-checkbox-name]');
		var noEndDateCheckboxName = (spanEl && spanEl.getAttribute('data-no-end-date-checkbox-name')) || '';
		if (!noEndDateCheckboxName) return;
		var dateInputs = formGroup.querySelectorAll('input.dob-input');
		function syncThisEndDateDisabled(checkbox) {
			if (!checkbox || checkbox.getAttribute('name') !== noEndDateCheckboxName) return;
			if (dateInputs.length !== 3) return;
			dateInputs.forEach(function (inp) {inp.disabled = checkbox.checked;});
		}
		document.addEventListener('change', function (e) {
			if (e.target && e.target.type === 'checkbox' && e.target.getAttribute('name') === noEndDateCheckboxName) {
				syncThisEndDateDisabled(e.target);
			}
		});
	})();
</script>
    </th:block>
</div>
</html>